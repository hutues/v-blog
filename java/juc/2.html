<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发编程-尚硅谷 | 就问你学不学</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/v-blog/img/icon.jpg">
    <link rel="stylesheet" href="/v-blog/css/style.css">
    <meta name="description" content="一时不学一时爽 一直不学一直爽">
    
    <link rel="preload" href="/v-blog/assets/css/0.styles.1ffe5c5b.css" as="style"><link rel="preload" href="/v-blog/assets/js/app.9757520d.js" as="script"><link rel="preload" href="/v-blog/assets/js/2.943addfd.js" as="script"><link rel="preload" href="/v-blog/assets/js/50.1697cd1a.js" as="script"><link rel="prefetch" href="/v-blog/assets/js/10.20d21062.js"><link rel="prefetch" href="/v-blog/assets/js/100.3f217fe9.js"><link rel="prefetch" href="/v-blog/assets/js/101.105eaaab.js"><link rel="prefetch" href="/v-blog/assets/js/102.02de7b3a.js"><link rel="prefetch" href="/v-blog/assets/js/103.559454f5.js"><link rel="prefetch" href="/v-blog/assets/js/104.ea42acd8.js"><link rel="prefetch" href="/v-blog/assets/js/105.8d351003.js"><link rel="prefetch" href="/v-blog/assets/js/106.dde5b14d.js"><link rel="prefetch" href="/v-blog/assets/js/107.940f8e4c.js"><link rel="prefetch" href="/v-blog/assets/js/108.5891d6eb.js"><link rel="prefetch" href="/v-blog/assets/js/109.ce709703.js"><link rel="prefetch" href="/v-blog/assets/js/11.86bed542.js"><link rel="prefetch" href="/v-blog/assets/js/110.383ab457.js"><link rel="prefetch" href="/v-blog/assets/js/111.121b0ca3.js"><link rel="prefetch" href="/v-blog/assets/js/112.c49dca7f.js"><link rel="prefetch" href="/v-blog/assets/js/113.aef910eb.js"><link rel="prefetch" href="/v-blog/assets/js/114.dacef158.js"><link rel="prefetch" href="/v-blog/assets/js/115.eddc9987.js"><link rel="prefetch" href="/v-blog/assets/js/116.5fff8536.js"><link rel="prefetch" href="/v-blog/assets/js/117.c04b4a12.js"><link rel="prefetch" href="/v-blog/assets/js/118.a4892f90.js"><link rel="prefetch" href="/v-blog/assets/js/119.0da7b717.js"><link rel="prefetch" href="/v-blog/assets/js/12.d8c07dec.js"><link rel="prefetch" href="/v-blog/assets/js/120.103742f0.js"><link rel="prefetch" href="/v-blog/assets/js/121.23fc8493.js"><link rel="prefetch" href="/v-blog/assets/js/122.cb17a43a.js"><link rel="prefetch" href="/v-blog/assets/js/123.545c66ab.js"><link rel="prefetch" href="/v-blog/assets/js/124.2aa20394.js"><link rel="prefetch" href="/v-blog/assets/js/125.aed46207.js"><link rel="prefetch" href="/v-blog/assets/js/126.5777cb4e.js"><link rel="prefetch" href="/v-blog/assets/js/127.459a7ebe.js"><link rel="prefetch" href="/v-blog/assets/js/128.9e58fdfd.js"><link rel="prefetch" href="/v-blog/assets/js/129.6d6d74d4.js"><link rel="prefetch" href="/v-blog/assets/js/13.0832914a.js"><link rel="prefetch" href="/v-blog/assets/js/130.b4436fa4.js"><link rel="prefetch" href="/v-blog/assets/js/131.4a8a7af2.js"><link rel="prefetch" href="/v-blog/assets/js/132.16a8c34a.js"><link rel="prefetch" href="/v-blog/assets/js/133.2a5afa49.js"><link rel="prefetch" href="/v-blog/assets/js/14.b7938acc.js"><link rel="prefetch" href="/v-blog/assets/js/15.fb1b5215.js"><link rel="prefetch" href="/v-blog/assets/js/16.e4456b0c.js"><link rel="prefetch" href="/v-blog/assets/js/17.438f8f1d.js"><link rel="prefetch" href="/v-blog/assets/js/18.0ede3ec4.js"><link rel="prefetch" href="/v-blog/assets/js/19.5a9e5b3b.js"><link rel="prefetch" href="/v-blog/assets/js/20.906cae4f.js"><link rel="prefetch" href="/v-blog/assets/js/21.1dc6915d.js"><link rel="prefetch" href="/v-blog/assets/js/22.13df625f.js"><link rel="prefetch" href="/v-blog/assets/js/23.c32f30b3.js"><link rel="prefetch" href="/v-blog/assets/js/24.3341a2c8.js"><link rel="prefetch" href="/v-blog/assets/js/25.27aaa382.js"><link rel="prefetch" href="/v-blog/assets/js/26.83ac3cdf.js"><link rel="prefetch" href="/v-blog/assets/js/27.92749014.js"><link rel="prefetch" href="/v-blog/assets/js/28.d978fd58.js"><link rel="prefetch" href="/v-blog/assets/js/29.81ef10bf.js"><link rel="prefetch" href="/v-blog/assets/js/3.5b997c96.js"><link rel="prefetch" href="/v-blog/assets/js/30.f4ff455b.js"><link rel="prefetch" href="/v-blog/assets/js/31.1bfdb408.js"><link rel="prefetch" href="/v-blog/assets/js/32.0ea2a98e.js"><link rel="prefetch" href="/v-blog/assets/js/33.ff83980c.js"><link rel="prefetch" href="/v-blog/assets/js/34.eab36e97.js"><link rel="prefetch" href="/v-blog/assets/js/35.43ab05c1.js"><link rel="prefetch" href="/v-blog/assets/js/36.5bf5c02a.js"><link rel="prefetch" href="/v-blog/assets/js/37.58673278.js"><link rel="prefetch" href="/v-blog/assets/js/38.21ad9984.js"><link rel="prefetch" href="/v-blog/assets/js/39.6ff55661.js"><link rel="prefetch" href="/v-blog/assets/js/4.987baa04.js"><link rel="prefetch" href="/v-blog/assets/js/40.2cba54e2.js"><link rel="prefetch" href="/v-blog/assets/js/41.84a20a21.js"><link rel="prefetch" href="/v-blog/assets/js/42.9da44a43.js"><link rel="prefetch" href="/v-blog/assets/js/43.fafa9458.js"><link rel="prefetch" href="/v-blog/assets/js/44.ed627efa.js"><link rel="prefetch" href="/v-blog/assets/js/45.fe00ab2d.js"><link rel="prefetch" href="/v-blog/assets/js/46.aaa056b9.js"><link rel="prefetch" href="/v-blog/assets/js/47.9a157331.js"><link rel="prefetch" href="/v-blog/assets/js/48.d3e9bab8.js"><link rel="prefetch" href="/v-blog/assets/js/49.4ac26c7b.js"><link rel="prefetch" href="/v-blog/assets/js/5.d250cb53.js"><link rel="prefetch" href="/v-blog/assets/js/51.80725f36.js"><link rel="prefetch" href="/v-blog/assets/js/52.83fb2a4c.js"><link rel="prefetch" href="/v-blog/assets/js/53.2332a201.js"><link rel="prefetch" href="/v-blog/assets/js/54.b5029957.js"><link rel="prefetch" href="/v-blog/assets/js/55.8c6b22f7.js"><link rel="prefetch" href="/v-blog/assets/js/56.abd4bb82.js"><link rel="prefetch" href="/v-blog/assets/js/57.bd7b8633.js"><link rel="prefetch" href="/v-blog/assets/js/58.46c17994.js"><link rel="prefetch" href="/v-blog/assets/js/59.a31226a2.js"><link rel="prefetch" href="/v-blog/assets/js/6.d7e152ce.js"><link rel="prefetch" href="/v-blog/assets/js/60.058714d1.js"><link rel="prefetch" href="/v-blog/assets/js/61.0740b5c3.js"><link rel="prefetch" href="/v-blog/assets/js/62.4f184bd7.js"><link rel="prefetch" href="/v-blog/assets/js/63.7a9d91cc.js"><link rel="prefetch" href="/v-blog/assets/js/64.fef20fa9.js"><link rel="prefetch" href="/v-blog/assets/js/65.cbd95b1f.js"><link rel="prefetch" href="/v-blog/assets/js/66.b2291a46.js"><link rel="prefetch" href="/v-blog/assets/js/67.db00cb98.js"><link rel="prefetch" href="/v-blog/assets/js/68.c28ede87.js"><link rel="prefetch" href="/v-blog/assets/js/69.50649a9a.js"><link rel="prefetch" href="/v-blog/assets/js/7.20e85fea.js"><link rel="prefetch" href="/v-blog/assets/js/70.66f17c56.js"><link rel="prefetch" href="/v-blog/assets/js/71.af535864.js"><link rel="prefetch" href="/v-blog/assets/js/72.d24326c6.js"><link rel="prefetch" href="/v-blog/assets/js/73.f6598b47.js"><link rel="prefetch" href="/v-blog/assets/js/74.59684f4d.js"><link rel="prefetch" href="/v-blog/assets/js/75.0f462117.js"><link rel="prefetch" href="/v-blog/assets/js/76.63c07c20.js"><link rel="prefetch" href="/v-blog/assets/js/77.32af0893.js"><link rel="prefetch" href="/v-blog/assets/js/78.3cc730d2.js"><link rel="prefetch" href="/v-blog/assets/js/79.3e4e669f.js"><link rel="prefetch" href="/v-blog/assets/js/8.62d70654.js"><link rel="prefetch" href="/v-blog/assets/js/80.1029dfc9.js"><link rel="prefetch" href="/v-blog/assets/js/81.8add107d.js"><link rel="prefetch" href="/v-blog/assets/js/82.e2dc49c1.js"><link rel="prefetch" href="/v-blog/assets/js/83.9f6a27c1.js"><link rel="prefetch" href="/v-blog/assets/js/84.0c04de55.js"><link rel="prefetch" href="/v-blog/assets/js/85.49fe0a69.js"><link rel="prefetch" href="/v-blog/assets/js/86.ab084c8b.js"><link rel="prefetch" href="/v-blog/assets/js/87.7def94a0.js"><link rel="prefetch" href="/v-blog/assets/js/88.6f8da00a.js"><link rel="prefetch" href="/v-blog/assets/js/89.70cefdba.js"><link rel="prefetch" href="/v-blog/assets/js/9.10bc236a.js"><link rel="prefetch" href="/v-blog/assets/js/90.6b770133.js"><link rel="prefetch" href="/v-blog/assets/js/91.db52b1bc.js"><link rel="prefetch" href="/v-blog/assets/js/92.e37b0c57.js"><link rel="prefetch" href="/v-blog/assets/js/93.682638aa.js"><link rel="prefetch" href="/v-blog/assets/js/94.4c42d5b5.js"><link rel="prefetch" href="/v-blog/assets/js/95.012d67a2.js"><link rel="prefetch" href="/v-blog/assets/js/96.70211961.js"><link rel="prefetch" href="/v-blog/assets/js/97.12d99977.js"><link rel="prefetch" href="/v-blog/assets/js/98.7db8c36f.js"><link rel="prefetch" href="/v-blog/assets/js/99.b02ac7a0.js">
    <link rel="stylesheet" href="/v-blog/assets/css/0.styles.1ffe5c5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v-blog/" class="home-link router-link-active"><!----> <span class="site-name">就问你学不学</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/juc/" class="nav-link router-link-active">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/nio/" class="nav-link">
  NIO
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/jdk-features/" class="nav-link">
  JDK
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/data-structures-algorithms/" class="nav-link">
  数据结构/算法
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java框架" class="dropdown-title"><span class="title">Java框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java框架" class="mobile-dropdown-title"><span class="title">Java框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring-mvc/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring-boot/" class="nav-link">
  SpringBoot
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/dubbo/" class="nav-link">
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/spring-cloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/netty/" class="nav-link">
  Netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/db/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/job/" class="nav-link">
  Job
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/mq/" class="nav-link">
  Mq
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/fdfs/" class="nav-link">
  分布式文件系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/linux/vim/" class="nav-link">
  Vim
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/linux/shell/" class="nav-link">
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/front-end/" class="nav-link">
  Samples
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hutues/v-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/hm223/blog-all" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/juc/" class="nav-link router-link-active">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/nio/" class="nav-link">
  NIO
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/jvm/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/jdk-features/" class="nav-link">
  JDK
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/tools/" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/data-structures-algorithms/" class="nav-link">
  数据结构/算法
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java框架" class="dropdown-title"><span class="title">Java框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java框架" class="mobile-dropdown-title"><span class="title">Java框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring-mvc/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/frameworks-java/spring-boot/" class="nav-link">
  SpringBoot
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/dubbo/" class="nav-link">
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/spring-cloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/zookeeper/" class="nav-link">
  Zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/java/micro-service/netty/" class="nav-link">
  Netty
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/db/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/mongodb/" class="nav-link">
  Mongodb
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/db/es/" class="nav-link">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/job/" class="nav-link">
  Job
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/mq/" class="nav-link">
  Mq
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/middle-ware/fdfs/" class="nav-link">
  分布式文件系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/linux/vim/" class="nav-link">
  Vim
</a></li><li class="dropdown-item"><!----> <a href="/v-blog/linux/shell/" class="nav-link">
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/v-blog/front-end/" class="nav-link">
  Samples
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hutues/v-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://gitee.com/hm223/blog-all" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/v-blog/java/juc/Main1" class="sidebar-heading clickable open"><span>【入门】Java并发编程入门课</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/v-blog/java/juc/1.html" class="sidebar-link">并发编程-传智播客</a></li><li><a href="/v-blog/java/juc/2.html" aria-current="page" class="active sidebar-link">并发编程-尚硅谷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#线程的出现" class="sidebar-link">线程的出现</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#java中如何应用多线程" class="sidebar-link">java中如何应用多线程</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#线程的状态" class="sidebar-link">线程的状态</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#线程的启动" class="sidebar-link">线程的启动</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#线程的中断" class="sidebar-link">线程的中断</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#thread-sleep" class="sidebar-link">Thread.sleep</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#thread-join" class="sidebar-link">Thread.join</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#synchronized" class="sidebar-link">synchronized</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#lock" class="sidebar-link">Lock</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#countdownlatch" class="sidebar-link">CountDownLatch</a></li><li class="sidebar-sub-header"><a href="/v-blog/java/juc/2.html#信号量-semaphore" class="sidebar-link">信号量 Semaphore</a></li></ul></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/v-blog/java/juc/Main2" class="sidebar-heading clickable"><span>【进阶】Java并发编程实战-极客时间</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>并发编程开篇</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v-blog/java/juc/geek/0/1.html" class="sidebar-link">开篇词 | 你为什么需要学习并发编程？</a></li><li><a href="/v-blog/java/juc/geek/0/2.html" class="sidebar-link">学习攻略 | 如何才能学好并发编程？</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>第一部分：并发理论基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>第二部分：并发工具类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>第三部分：并发设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>第四部分：案例分析</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>第五部分：其他并发模型</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="并发编程-尚硅谷"><a href="#并发编程-尚硅谷" class="header-anchor">#</a> 并发编程-尚硅谷</h1> <ul><li>背景</li> <li>JMM内存模型</li> <li>并发编程三大特性</li> <li>线程通信的相关知识</li> <li>理解java中的锁</li> <li>JUC-同步工具类使用</li> <li>理解线程池的原理</li></ul> <h1 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h1> <p>在计算机早期，在没有线程的年代，在同一个进程中，程序的处理流程都是顺序的，下一个流程的开始必须等待上一个流程的结束，如果其中某一个流程非常耗时，那么会影响整个流程的处理时间</p> <p><img src="/v-blog/img/java/middle-java/juc/1585712700471.png" alt="1585712700471"></p> <p>思考：怎么优化呢</p> <p>将耗时的部分改成异步处理</p> <h2 id="线程的出现"><a href="#线程的出现" class="header-anchor">#</a> 线程的出现</h2> <p>有了进程以后，为什么还要发明线程呢？</p> <ol><li>在多核CPU中，利用多线程可以实现并行 执行</li> <li>同步处理的流程容易发生阻塞，可以用线程来实现异步处理，提高程序处理实时性</li> <li>线程可以认为是轻量级的进程，所以线程的创建、销毁 比进程更快 （性能开销更小）</li></ol> <h1 id="多线程应用"><a href="#多线程应用" class="header-anchor">#</a> 多线程应用</h1> <h2 id="java中如何应用多线程"><a href="#java中如何应用多线程" class="header-anchor">#</a> java中如何应用多线程</h2> <ul><li>继承Thread</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyThread</span> myThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">MyThread</span> myThread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        myThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        myThread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>实现Runnable</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyRunnable</span> myRunnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myRunnable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myRunnable<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Thread和Runnable区别？</p> <p>1、java是单继承，如果一个类已经继承了父类，那么无法继承Thread,所以需要实现Runnable</p> <p>2、Thread实现了Runnable接口</p> <p>3、实现Runnable资源可以共享</p></blockquote> <ul><li>实现Callable</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyCallable</span> myCallable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//线程池后面会详细的说明，先知道有这么一个东西即可</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>myCallable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Callable跟其它两种线程的区别？</p> <p>说白了：Callable有返回值</p></blockquote> <h2 id="线程的状态"><a href="#线程的状态" class="header-anchor">#</a> 线程的状态</h2> <ul><li><p>线程的状态</p> <p>线程一共有 6 种状态（NEW、RUNNABLE、BLOCKED、 WAITING、TIME_WAITING、TERMINATED）</p></li></ul> <blockquote><p>NEW：初始状态，线程被创建，但是还没有调用start方法</p> <p>RUNNABLED：运行状态，调用start方式让线程处于“运行中”</p> <p>BLOCKED：阻塞状态，表示线程进入等待状态,也就是线程 因为某种原因放弃了CPU使用权，阻塞也分为几种情况</p> <p>➢ 同步阻塞：运行的线程在获取锁时，若该锁被其他线程占用了，那么当前线程会阻塞</p> <p><img src="/v-blog/img/java/middle-java/juc/1585704992434.png" alt="1585704992434"></p> <p>➢ 其他阻塞：运行的线程执行Thread.sleep或者t.join方法时，称为其他阻塞</p> <blockquote><p>Thread.sleep(1000)</p></blockquote> <p>WAITING:调用wait等方法等待,等待唤醒(notify或notifyAll)</p> <blockquote><p>wait();</p></blockquote> <p>TIME_WAITING：超时等待状态，等待另一个线程在指定的时间访问唤醒,超时以后线程状态就是TIME_WAITING</p> <blockquote><p>wait(2000)</p></blockquote> <p>TERMINATED：终止状态，表示当前线程执行完毕</p> <blockquote><p>run方法执行完毕</p></blockquote></blockquote> <h2 id="线程的启动"><a href="#线程的启动" class="header-anchor">#</a> 线程的启动</h2> <p>前面我们通过一些案例演示了线程的启动，也就是调用 start()方法去启动一个线程。</p> <p>我们看到调用 start 方法实际上是调用一个 native 方法 start0()来启动一个线程。</p> <h2 id="线程的中断"><a href="#线程的中断" class="header-anchor">#</a> 线程的中断</h2> <p>要优雅的去中断一个线程，在线程中提供了一个 interrupt 方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterrupDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//isInterrupted()默认是false,如果当前线程调用了interrupt()之后，isInterrupted()变成true</span>
            <span class="token comment">//说白了，就是判断有没有调用线程中断方法</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;while之外的输出:&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;InterrupDemo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="thread-sleep"><a href="#thread-sleep" class="header-anchor">#</a> Thread.sleep</h2> <p>Thread.sleep（）：让当前的流程睡眠多少毫秒</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSleepDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;开始:&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2 秒</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;结束:&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="thread-join"><a href="#thread-join" class="header-anchor">#</a> Thread.join</h2> <p>Thread.join:等待某一个线程执行结束</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadJoinDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//需求：让第二线程必须等到第一个线程执行完之后再执行</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//阻塞，等到t1线程执行完毕</span>

        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//期望结果：t1永远都在t2前面打印</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="jmm内存模型"><a href="#jmm内存模型" class="header-anchor">#</a> JMM内存模型</h1> <ol><li><p>Java内存模型（简称：JMM）定义了共享内存中多线程程序读写操作 的行为规范，通过这些规则来规范对内存的读写操作从而保证指令的正 确性，它解决了 CPU 多级缓存、处理器优化、指令重排序 导致的内存访问问题</p> <p>总结：JMM让java程序与硬件指令进行了隔离</p></li> <li><p>由于JVM运行程序的实体是线程，而每个线程创建时JVM都会为其创建一个工作内存，用于存储线程私有的数据。而Java内存模型中规定所有变量都存储在主内存，主内存是共享内存区域，所有线程都可以访问。</p> <p>总结：JMM把内存分为两块，一块是私有线程的工作区域（工作内存），一块是所有线程的共享区域（主内存）</p></li> <li><p>线程对变量的操作(读取赋值等)必须在工作内存中进行，首先要将变量从主内存拷贝的自己的工作内存空间，然后对变量进行操作，操作完成后再将变量写回主内存，不能直接操作主内存中的变量，工作内存中存储着主内存中的变量副本，前面说过，工作内存是每个线程的私有数据区域，因此不同的线程无法访问其它线程的工作内存，线程间的通信(传值)必须通过主内存来完成，</p> <p>总结：线程跟线程之间是相互隔离，线程跟线程交互需要通过主内存</p></li></ol> <p>其简要访问过程如下图：</p> <p><img src="/v-blog/img/java/middle-java/juc/1585712787516.png" alt="1585712787516"></p> <p><img src="/v-blog/img/java/middle-java/juc/1585712770127.png" alt="1585712770127"></p> <div class="language- extra-class"><pre class="language-text"><code>关于JMM中的主内存和工作内存说明

- 主内存
  主要存储的是Java实例对象，所有线程创建的实例对象都存放在主内存中，不管该实例对象是成员变量还是方法中的本地变量，也包括了共享的类信息、常量、静态变量。由于是共享数据区域，多条线程对同一个变量进行访问可能会发现线程安全问题。
- 工作内存
  每个线程只能访问自己的工作内存，即线程中的本地变量对其它线程是不可见的，就算是两个线程执行的是同一段代码，它们也会在自己的工作内存中创建属于当前线程的本地变量。注意由于工作内存是每个线程的私有数据，线程之间的工作内存无法相互访问，因此存储在工作内存的数据不存在线程安全问题。
</code></pre></div><ul><li>JMM 内存指令同步的流程</li></ul> <p><img src="/v-blog/img/java/middle-java/juc/1585712821063.png" alt="1585712821063"></p> <blockquote><p>举例：线程操作一个变量分两步</p> <p>1.主内存变量到工作内存到线程使用：Lock--&gt;Read--&gt;Load--&gt;use--&gt;线程使用</p> <p>2.线程操作变量完成同步到工作内存，工作内存刷新到主内存过程：：Assign--&gt;Store--&gt;Write---&gt;Unlock</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>1. lock(锁定)：作用于主内存的变量，把一个变量标记为一条线程独占状态

2. unlock(解锁)：作用于主内存的变量，把一个处于锁定状态的变量释放出来，释放后的变量才可以被其他线程锁定

3. read(读取)：作用于主内存的变量，把一个变量值从主内存传输到线程的工作内存中，以便随后的load动作使用

4. load(载入)：作用于工作内存的变量，它把read操作从主内存中得到的变量值放入工作内存的变量副本中

5. use(使用)：作用于工作内存的变量，use指令表示的是线程去加载工作内存的变量，从而进行变量操作

6. assign(赋值)：作用于工作内存的变量，私有线程运行结束之后需要把运行完最新的数据重新赋值给工作内存变量

7. store(存储)：作用于工作内存的变量，把工作内存中的一个变量的值传送到主内存中，以便随后的write操作

8. write(写入)：作用于工作内存的变量，它把store操作从工作内存中的一个变量的值传送到主内存的变量中
</code></pre></div><h1 id="java并发编程三大特性"><a href="#java并发编程三大特性" class="header-anchor">#</a> Java并发编程三大特性</h1> <ul><li>原子性</li></ul> <p>一个线程在CPU中操作不可暂定，也不可中断，要不执行完成，要不不执行</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> ticketNum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>ticketNum <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;抢到一张票,剩余:&quot;</span><span class="token operator">+</span>ticketNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ticketNum<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketDemo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>demo<span class="token operator">::</span><span class="token function">getTicket</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//结论：不是原子操作，怎么保证原子操作呢？</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>不是原子操作，怎么保证原子操作呢？</p> <p>JMM对原子性的保证：</p> <p>1.synchronized：同步加锁</p> <p>2.JUC里面的lock：加锁</p></blockquote> <ul><li>可见性</li></ul> <p>多个线程访问同一个变量是，一个线程修改这个变量的值，其它线程能够看到修改之后的值</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第一个线程执行完毕...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//思考：第一个线程会不会跳槽while循环，输出System.out.println(&quot;第一个线程执行完毕...&quot;);</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第二线程执行完毕...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>JMM对可见性的保证：</p> <p>加Volatile关键字</p> <p>对Volatile变量进行<strong>写操作</strong>的时候，会在写操作之后加一个指令（store）,会将数据强制刷新到主内存中</p> <p>对Volatile变量进行<strong>读操作</strong>的时候，会在读操作之前加一个指令（load），强制每次都去主内存拉取最新的变量值</p></blockquote> <ul><li>有序性</li></ul> <div class="language- extra-class"><pre class="language-text"><code>程序执行的顺序按照代码的先后顺序执行。
一般来说处理器为了提高程序运行效率，可能会对输入代码进行优化，它不保证程序中各个语句的执行先后顺序同代码中的顺序一致，但是它会保证程序最终执行结果和代码顺序执行的结果是一致的。如下：
int a=2; //1 

int b=3; //2 

int rs=a*b; //3

则因为指令重排序，他还可能执行顺序为 1-2-3,2-1-3
 但是绝对不会是3-1-2/3-2-1这种顺序,因为这打破了依赖关系。
</code></pre></div><h1 id="volatile"><a href="#volatile" class="header-anchor">#</a> volatile</h1> <div class="language- extra-class"><pre class="language-text"><code>volatile 关键字的作用是变量在多个线程之间可见。并且能够保证所修饰变量的有序性：
1、 保证变量的可见性：当一个被volatile关键字修饰的变量被一个线程修改的时候，其他线程可以立刻得到修改之后的结果。
原理：当一个线程向被volatile关键字修饰的变量写入数据的时候，虚拟机会强制它被值刷新到主内存中。当一个线程用到被volatile关键字修饰的值的时候，虚拟机会强制要求它从主内存中读取。保证读取的值是最新的值
2、 防止指令重排序：指令重排序是编译器和处理器为了高效对程序进行优化的手段，它只能保证程序执行的结果时正确的，但是无法保证程序的操作顺序与代码顺序一致。这在单线程中不会构成问题，但是在多线程中就会出现问题。字段加入voliate，就是为了防止指令重排序。
</code></pre></div><p><strong>多线程环境重排序问题</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>
    
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">//写操作</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// 1</span>
       flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>   <span class="token comment">//2</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//读操作</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 3</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> a<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//4</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//假设write方法和reader在不同线程环境下运行，可能write会被其它线程优先执行，由于指令重排序会把2放在1前面，那么2会优于1先执行，此时另外一个线程执行reader方法，由于flag=ture,但是a=0,int i的结果不是我们期望的结果</span>
<span class="token punctuation">}</span>
</code></pre></div><h1 id="理解线程通信"><a href="#理解线程通信" class="header-anchor">#</a> 理解线程通信</h1> <p>wait：表示持有对象锁的线程 释放对象锁权限，并且释 放 cpu 资源并进入阻塞状态。</p> <p>notify: 唤醒一个阻塞状态的线程</p> <p>notifyAll: 唤醒全部阻塞状态的线程</p> <ul><li>ThreadA</li></ul> <div class="language- extra-class"><pre class="language-text"><code>public class ThreadA extends Thread {

    private Object obj;

    public ThreadA(Object obj){
        this.obj = obj;
    }

    @Override
    public void run(){
        synchronized (obj){
            System.out.println(Thread.currentThread().getName()+&quot;ThreadA开始了....&quot;);
            try {
                obj.wait();//阻塞，等待唤醒
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName()+&quot;ThreadA结束了....&quot;);
        }
    }

}
</code></pre></div><ul><li>ThreadB</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadB</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> obj<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ThreadB</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ThreadB开始了....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//唤醒</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;ThreadB结束了....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>NotifyWaitDemo</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotifyWaitDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadA</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">ThreadB</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h1 id="理解java中的锁"><a href="#理解java中的锁" class="header-anchor">#</a> 理解java中的锁</h1> <p>第一个问题： 什么是线程安全问题？</p> <div class="language- extra-class"><pre class="language-text"><code>多线程操作共享变量，导致访问数据出问题。
</code></pre></div><p>换个方式提问：出现线程安全问题的条件</p> <div class="language- extra-class"><pre class="language-text"><code>1、多线程
2、共享变量
</code></pre></div><h2 id="synchronized"><a href="#synchronized" class="header-anchor">#</a> synchronized</h2> <p><strong>synchronized 的基本认识</strong></p> <p>在多线程并发编程中synchronized一直是元老级角色，很 多人都会称呼它为重量级锁</p> <ul><li>synchronize使用方式</li></ul> <p>1、修饰在实例方法：作用当前实例加锁</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketDemo</span><span class="token punctuation">{</span>

	<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>2、修饰在静态方法:作用当前类加锁</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> ticketNum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>3、修饰在代码块:进入同 步块加锁</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketDemo1</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">int</span> ticketNum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span>   <span class="token keyword">void</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">TicketDemo1</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>工作原理</strong></li></ul> <p>JVM 是通过进入、退出对象监视器( Monitor )来实现对方法、同步块的同步的。</p> <blockquote><p>通过javap -c TickerDemo.class 反编译指令查看</p></blockquote> <p><img src="/v-blog/img/java/middle-java/juc/1585729940477.png" alt="1585729940477"></p> <ul><li>死锁</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockDemo</span> <span class="token punctuation">{</span>


    <span class="token keyword">static</span> <span class="token class-name">Object</span> o1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> o2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//第一个线程获得o1锁对象成功</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread 1 get o1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//第一个线程获取o2锁对象的时候发现o2锁处于了Monitor状态，那么需要等待o2锁释放吧</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread1 get o2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//第二个线程获得o2锁对象成功</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread 2 get o2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//第二个线程获取o1锁对象的时候发现o1锁处于了Monitor状态，那么需要等待o1锁释放吧</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;thread2 get o1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>第一个线程里面需要等待第二个线程所释放，而第二个线程里面需要等待第一个线程锁释放，造成两个线程相互等待，这就是死锁</p></blockquote> <h2 id="lock"><a href="#lock" class="header-anchor">#</a> Lock</h2> <ul><li><strong>J.U.C 简介</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>Java.util.concurrent 是在并发编程中比较常用的工具类，里面包含很多用来在并发场景中使用的工具类。比如线程池、阻塞队列、同步器、并发集合等等
</code></pre></div><blockquote><p><strong>Doug Lea</strong></p></blockquote> <p><strong>可重入锁ReentrantLock</strong></p> <p>重入锁: 表示支持重新进入的锁，调用 lock 方 法获取了锁之后，再次调用 lock，是不会再阻塞，内部直接增加重入次数 就行了，标识这个线程已经重复获取一把锁而不需要等待锁的释放，比如递归调用</p> <ul><li><h4 id="lock锁用法"><a href="#lock锁用法" class="header-anchor">#</a> lock锁用法</h4> <div class="language-java extra-class"><pre class="language-java"><code>	<span class="token class-name">Lock</span> lock  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
      lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可能会出现线程安全的操作</span>
  <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
	<span class="token comment">//尽量在finally中释放锁</span>
	
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>API方法</strong></p> <ul><li>lock()用来获取锁</li> <li>unlock()释放锁，最好在finally块中释放</li></ul> <p>代码改进</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TicketDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> ticketNum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ticketNum <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:抢到了一张票，剩余：&quot;</span> <span class="token operator">+</span> ticketNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ticketNum<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TicketDemo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TicketDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>demo<span class="token operator">::</span><span class="token function">getTicket</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>lock锁与synchronized比较</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>1. synchronized 是内部锁,自动化的上锁与释放锁,而lock是手动的,需要人为的上锁和释放锁,lock比较灵活,但是代码量多
2、lock是一个接口，而synchronized是Java中的关键字
3、性能上来说，在资源竞争不激烈的情形下，Lock性能稍微比synchronized差点。但是当并发非常激烈的时候，synchronized的性能就会下降几十倍。而ReentrantLock确还能维持常态。
</code></pre></div><h1 id="juc-同步工具类"><a href="#juc-同步工具类" class="header-anchor">#</a> JUC-同步工具类</h1> <h2 id="countdownlatch"><a href="#countdownlatch" class="header-anchor">#</a> CountDownLatch</h2> <ul><li>介绍</li></ul> <div class="language- extra-class"><pre class="language-text"><code>countdownlatch 是一个同步工具类，它允许一个或多个线程一直等待，直到其他线程的操作执行完毕再执行
</code></pre></div><ul><li>API</li></ul> <table><thead><tr><th>CountDownLatch类</th> <th></th></tr></thead> <tbody><tr><td>CountDownLatch(int count)</td> <td>创建CountDownLatch 实例并设置预定计数次数</td></tr> <tr><td>void countDown()</td> <td>如果当前计数大于零，调用一次内部的计数次数减1</td></tr> <tr><td>void await()</td> <td>如果内部的计数器大于0则一直等待，除非线程被中断。如果当前的计数为零，则唤醒当前阻塞</td></tr></tbody></table> <ul><li>案例</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span><span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
       <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;挂号&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3-1=2</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;看病&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2-1=1</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;拿药&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1-1=0</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 阻塞，直到内部计数器为0</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;回家...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="信号量-semaphore"><a href="#信号量-semaphore" class="header-anchor">#</a> **信号量 Semaphore **</h2> <p>[ˈseməfɔːr]</p> <ul><li>介绍</li></ul> <div class="language- extra-class"><pre class="language-text"><code>限制访问某些资源的线程数量，比如某商场就 5 个停车位，每个停车位只能停一辆车，如果这个时候来了 10 辆车，必须要等前面有空的车位才能进入
</code></pre></div><ul><li>api</li></ul> <table><thead><tr><th></th> <th></th></tr></thead> <tbody><tr><td>==Semaphore(int permits)==</td> <td>permits是允许同时运行的线程数目,创建指定数据线程的信号量</td></tr> <tr><td>==void acquire()==</td> <td>方法阻塞，直到申请获取到许可证才可以运行当前线程</td></tr> <tr><td>==void release()==</td> <td>释放当前线程一个阻塞的 <code>acquire()</code> 方法，方法增加一个许可证,阻塞的线程会获取到这个许可证</td></tr></tbody></table> <ul><li>案例</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">extends</span>  <span class="token class-name">Thread</span><span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Semaphore</span> semaphore<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token class-name">Semaphore</span> semaphore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>semaphore <span class="token operator">=</span> semaphore<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获得一个令牌, 如果拿不到令牌，就会阻塞</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第&quot;</span><span class="token operator">+</span>num<span class="token operator">+</span><span class="token string">&quot; 抢占一个车位&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;第&quot;</span><span class="token operator">+</span>num<span class="token operator">+</span><span class="token string">&quot; 开走喽&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Semaphore</span> semaphore<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//令牌</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>semaphore<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h1 id="理解线程池与原理"><a href="#理解线程池与原理" class="header-anchor">#</a> 理解线程池与原理</h1> <ul><li>什么是线程池</li></ul> <div class="language- extra-class"><pre class="language-text"><code>在 Java 中，创建和销毁线程需要消耗很大的系统资源，线程池的核心逻辑是提前创建好若干个线程。如果有任务需要处理，则交给线程池中的线程来执行就行，任务处理完以后这个线程不会被销毁，而是等待后续分配任务。同时通过线程池来重复管理线程还可以避免创建线程所带来的性能开销
</code></pre></div><ul><li>线程池的优势</li></ul> <div class="language- extra-class"><pre class="language-text"><code>1. 避免创建线程和销毁线程的性能开销
2. 提高响应速度
</code></pre></div><ul><li>Java 中提供四种线程池(Executors)</li></ul> <div class="language- extra-class"><pre class="language-text"><code>newFixedThreadPool：该方法返回一个固定数量的线程池，特点就是可以重用固定数量线程的线程池使用
newSingleThreadExecutor: 创建一个线程的线程池，特点是使用单个工作线程执行任务
newCachedThreadPool：不限制容量的线程池，特点是可以根据需要来创建新的线程执行任务，没有特定的corePool
newScheduledThreadPool: 创建一个可以指定线程的数量的线程池，特点一个定时功能的线程池。
</code></pre></div><p><strong>newFixedThreadPool</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//线程池只会有两个线程执行任务</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个固定大小的线程池</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>newSingleThreadExecutor</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//线程池只有1个线程执行任务</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建线程池</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><strong>newCachedThreadPool</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 无限大小线程池 jvm自动回收</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建线程池</span>
        <span class="token class-name">ExecutorService</span> es <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            es<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        es<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>newScheduledThreadPool</strong></p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//任务线程池</span>
        <span class="token class-name">ScheduledExecutorService</span> service <span class="token operator">=</span>  <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//第一个参数：执行线程</span>
        <span class="token comment">//第二个参数：初始化延迟时间</span>
        <span class="token comment">//第三个参数：第二次以后最小执行任务的间隔时间</span>
        <span class="token comment">//第四个参数：时间单位</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始化：&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;--&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>案例</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskTest</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> service<span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            service<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TaskTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        service<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>ThreadpoolExecutor</strong></li></ul> <p>上面提到的四种线程池的构建，都是基于 ThreadpoolExecutor 来构建的,构造函数参数介绍</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span><span class="token comment">//核心线程数</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span><span class="token comment">//最大线程数</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span><span class="token comment">//线程执行和存活时间</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span><span class="token comment">//线程执行和存活时间单位</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span><span class="token comment">//任务队列</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span><span class="token comment">//线程创建工厂</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token comment">//队列满了,执行的拒绝策略) {</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="具体参数介绍"><a href="#具体参数介绍" class="header-anchor">#</a> 具体参数介绍</h5> <table><thead><tr><th>序号</th> <th>名称</th> <th>类型</th> <th>含义</th></tr></thead> <tbody><tr><td>1</td> <td>corePoolSize</td> <td>int</td> <td>核心线程池大小</td></tr> <tr><td>2</td> <td>maximumPoolSize</td> <td>int</td> <td>最大线程池大小</td></tr> <tr><td>3</td> <td>keepAliveTime</td> <td>long</td> <td>线程最大空闲时间</td></tr> <tr><td>4</td> <td>unit</td> <td>TimeUnit</td> <td>时间单位</td></tr> <tr><td>5</td> <td>workQueue</td> <td><code>BlockingQueue&lt;Runnable&gt;</code></td> <td>任务队列</td></tr> <tr><td>6</td> <td>threadFactory</td> <td>ThreadFactory</td> <td>线程创建工厂</td></tr> <tr><td>7</td> <td>handler</td> <td>RejectedExecutionHandler</td> <td>拒绝策略</td></tr></tbody></table> <h5 id="corepoolsize-核心线程池大小"><a href="#corepoolsize-核心线程池大小" class="header-anchor">#</a> corePoolSize 核心线程池大小</h5> <p>corePoolSize（线程池的基本大小）：线程池内部最少需要维护的线程大小</p> <h5 id="maximumpoolsize-最大线程池大小"><a href="#maximumpoolsize-最大线程池大小" class="header-anchor">#</a> maximumPoolSize 最大线程池大小</h5> <p>maximumPoolSize（线程池最大数量）：线程池允许创建的最大线程数。如果队列满了，并
且已创建的线程数小于最大线程数，则线程池会再创建新的线程执行任务。值得注意的是，如
果使用了无界的任务队列这个参数就没什么效果。</p> <h5 id="keepalivetime-线程活动保持时间"><a href="#keepalivetime-线程活动保持时间" class="header-anchor">#</a> keepAliveTime 线程活动保持时间</h5> <p>线程池里面的工作线程空闲后，保持存活的时间。</p> <h5 id="timeunit-时间单位"><a href="#timeunit-时间单位" class="header-anchor">#</a> TimeUnit 时间单位</h5> <p>TimeUnit是java.util.concurrent包下面的一个类，表示给定单元粒度的时间段</p> <table><thead><tr><th>单位</th> <th>含义</th></tr></thead> <tbody><tr><td>TimeUnit.DAYS</td> <td>天</td></tr> <tr><td>TimeUnit.HOURS</td> <td>小时</td></tr> <tr><td>TimeUnit.MINUTES</td> <td>分钟</td></tr> <tr><td>TimeUnit.SECONDS</td> <td>秒</td></tr> <tr><td>TimeUnit.MILLISECONDS</td> <td>毫秒</td></tr> <tr><td>TimeUnit.MICROSECONDS</td> <td>微妙（千分之一毫秒）</td></tr> <tr><td>TimeUnit.NANOSECONDS</td> <td>纳秒（千分之一微秒）</td></tr></tbody></table> <h5 id="workqueue-任务队列"><a href="#workqueue-任务队列" class="header-anchor">#</a> workQueue 任务队列</h5> <p>BlockingQueue是一个接口，用于保存等待执行的任务的阻塞队列，以下是实现类</p> <p>queue: [kjuː]</p> <table><thead><tr><th style="text-align:left;">BlockingQueue接口实现类</th> <th>含义</th></tr></thead> <tbody><tr><td style="text-align:left;">ArrayBlockingQueue</td> <td>有界队列，数组结构的有界阻塞队列，FIFO（先进先出）</td></tr> <tr><td style="text-align:left;">LinkedBlockingQueue</td> <td>链表结构的阻塞队列，此队列按FIFO，吞吐量通常要高于ArrayBlockingQueue。LinkedBlockingQueue会默认为Integer.MAX_VALUE容量，21亿多，也相当于无界队列了</td></tr> <tr><td style="text-align:left;">SynchronousQueue</td> <td>不存储元素的阻塞队列。每个插入操作必须等到另一个线程调用移除操作，否则插入操作一直处于阻塞状态。</td></tr> <tr><td style="text-align:left;">PriorityBlockingQueue</td> <td>具有优先级的无界阻塞队列</td></tr></tbody></table> <h5 id="threadfactory-线程创建工厂"><a href="#threadfactory-线程创建工厂" class="header-anchor">#</a> ThreadFactory 线程创建工厂</h5> <p>ThreadFactory：用于设置创建线程的工厂，可以通过线程工厂给每个创建出来的线程设置更有意义的名字</p> <p><strong>RejectedExecutionHandler 饱和拒绝策略</strong></p> <p>RejectedExecutionHandler（饱和策略）：当队列和线程池都满了，说明线程池处于饱和，那么可以采取饱和策略处理提交的新任务。这个策略默认情况下是AbortPolicy，表示无法处理新任务时抛出异常。在jdk中Java线程池框架提供了以下4种策略</p> <table><thead><tr><th>策略类</th> <th>含义</th></tr></thead> <tbody><tr><td>AbortPolicy</td> <td>默认测策略，直接抛出RejectedExecutionException运行时异常</td></tr> <tr><td>CallerRunsPolicy</td> <td>这个策略重试当前的任务，直到成功。</td></tr> <tr><td>DiscardOldestPolicy</td> <td>抛弃队列里面等待最久的一个任务，<br>然后把新的任务加到队列</td></tr> <tr><td>DiscardPolicy</td> <td>不处理，丢弃掉</td></tr></tbody></table> <ul><li>案例</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> taskId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> taskName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> taskId<span class="token punctuation">,</span> <span class="token class-name">String</span> taskName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> taskId<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskName <span class="token operator">=</span> taskName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getTaskId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> taskId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTaskId</span><span class="token punctuation">(</span><span class="token keyword">int</span> taskId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskId <span class="token operator">=</span> taskId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> taskName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTaskName</span><span class="token punctuation">(</span><span class="token class-name">String</span> taskName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>taskName <span class="token operator">=</span> taskName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;run taskId=&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token operator">+</span><span class="token string">&quot;,Thread:&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutorDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
                <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//核心线程数</span>
                <span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//maxpoolsize</span>
                <span class="token number">30</span><span class="token punctuation">,</span><span class="token comment">//空闲线程存活时间</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span><span class="token comment">//时间单位</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//数组有界队里</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//采用的拒绝策略是什么</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这边总共7个任务，2个线程执行任务，345进入队列，第六个线程启动最大线程数来执行，第七个任务触发拒绝策略</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">&quot;任务:&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>线程池的执行流程</li></ul> <p><img src="/v-blog/img/java/middle-java/juc/1585730051663.png" alt="1585730051663"></p> <h1 id="生产者消费者模型"><a href="#生产者消费者模型" class="header-anchor">#</a> 生产者消费者模型</h1> <div class="language- extra-class"><pre class="language-text"><code>生产者消费者模式是并发、多线程编程中经典的设计模式，生产者和消费者通过分离的执行工作解耦，简化了开发模式，生产者和消费者可以以不同的速度生产和消费数据。
</code></pre></div><ul><li>结构图</li></ul> <p><img src="/v-blog/img/java/middle-java/juc/1585744148133.png" alt="1585744148133"></p> <div class="language- extra-class"><pre class="language-text"><code>* 生产者生产手机
* 消费者购买手机
* 角色定义
 - 产品信息：华为、小米
 - 产品的仓库：生产者往里面存、消费者从里面消费
 - 消费者
 - 生产者
 - 启动类
</code></pre></div><ul><li>产品信息类：Product</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> from<span class="token punctuation">;</span><span class="token comment">//来自哪个生产者</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> from<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>from <span class="token operator">=</span> from<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> from<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>产品的仓库:Storage</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Storage</span> <span class="token punctuation">{</span>

    <span class="token comment">//阻塞队列</span>
    <span class="token keyword">private</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> storage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//用于生成产品编号</span>

    <span class="token comment">/**
     * 消费
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> storage<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;的&quot;</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&gt; id:&quot;</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;被消费了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 生产
     */</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Product</span> product<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        storage<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
        product<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>index<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>product<span class="token punctuation">.</span><span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,生产了&quot;</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;--&gt; id:&quot;</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div><ul><li>消费者:Consumer</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span>  <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Storage</span> storage<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token class-name">Storage</span> storage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>storage <span class="token operator">=</span> storage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                storage<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><ul><li>生产者:Producer</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span>  <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span class="token comment">//生产者名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pname<span class="token punctuation">;</span><span class="token comment">//生产的产品</span>
    <span class="token keyword">private</span> <span class="token class-name">Storage</span> storage<span class="token punctuation">;</span><span class="token comment">//仓库</span>

    <span class="token keyword">public</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pname<span class="token punctuation">,</span> <span class="token class-name">Storage</span> storage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pname <span class="token operator">=</span> pname<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>storage <span class="token operator">=</span> storage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>pname<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                storage<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>启动类</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockingQueueDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">BlockingQueueDemo</span> pac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BlockingQueueDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Storage</span> storage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Producer</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token string">&quot;生产者1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;小米手机&quot;</span><span class="token punctuation">,</span> storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Producer</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token string">&quot;生产者2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;华为手机&quot;</span><span class="token punctuation">,</span> storage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Consumer</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span>storage<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v-blog/java/juc/1.html" class="prev">
        并发编程-传智播客
      </a></span> <span class="next"><a href="/v-blog/java/juc/geek/0/1.html">
        开篇词 | 你为什么需要学习并发编程？
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/v-blog/assets/js/app.9757520d.js" defer></script><script src="/v-blog/assets/js/2.943addfd.js" defer></script><script src="/v-blog/assets/js/50.1697cd1a.js" defer></script>
  </body>
</html>
